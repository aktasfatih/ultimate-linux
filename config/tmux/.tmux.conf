# Ultimate Linux Development Setup - Tmux Configuration

# Prefix key (Ctrl-Space)
unbind C-b
set -g prefix C-Space
bind C-Space send-prefix

# General settings
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"
set -g history-limit 50000
set -g display-time 4000
set -g status-interval 5
set -g focus-events on
set -g mouse on
set -g set-clipboard on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on
set -s escape-time 0
setw -g aggressive-resize on
setw -g automatic-rename on
set -g set-titles on
set -g set-titles-string '#H:#S.#I.#P #W #T'

# Key bindings
# Reload configuration
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes with vim-like keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim-like keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Navigate windows
bind -r C-h previous-window
bind -r C-l next-window
bind Tab last-window

# Reorder windows
bind -r < swap-window -t -1\; select-window -t -1
bind -r > swap-window -t +1\; select-window -t +1

# Kill pane/window/session
bind x kill-pane
bind X kill-window
bind Q confirm-before -p "kill-session #S? (y/n)" kill-session

# Copy mode
setw -g mode-keys vi
bind Enter copy-mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line

# Paste
bind p paste-buffer
bind P choose-buffer

# Create new window with current path
bind c new-window -c "#{pane_current_path}"

# Synchronize panes
bind S setw synchronize-panes \; display-message "Synchronize panes: #{?pane_synchronized,on,off}"

# Toggle status bar
bind s if -F '#{s/off//:status}' 'set status off' 'set status on'

# Layout shortcuts
bind M-1 select-layout main-horizontal
bind M-2 select-layout main-vertical
bind M-3 select-layout even-horizontal
bind M-4 select-layout even-vertical
bind M-5 select-layout tiled

# Join/send panes
bind J choose-window 'join-pane -h -s "%%"'
bind B break-pane -d

# Session management
bind C-c new-session
bind C-f command-prompt -p find-session 'switch-client -t %%'

# Theme and appearance
# Status bar
set -g status-position top
set -g status-justify left
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'
set -g status-left-length 100
set -g status-right-length 100

# Left side of status bar
set -g status-left '#[fg=#1e1e2e,bg=#89b4fa,bold] #S #[fg=#89b4fa,bg=#313244,nobold]#[fg=#cdd6f4,bg=#313244] #(whoami) #[fg=#313244,bg=#1e1e2e,nobold]'

# Right side of status bar
set -g status-right '#[fg=#313244,bg=#1e1e2e,nobold]#[fg=#cdd6f4,bg=#313244] %Y-%m-%d #[fg=#45475a,bg=#313244,nobold]#[fg=#cdd6f4,bg=#45475a] %H:%M #[fg=#89b4fa,bg=#45475a,nobold]#[fg=#1e1e2e,bg=#89b4fa,bold] #H '

# Window status
setw -g window-status-format '#[fg=#1e1e2e,bg=#313244,nobold]#[fg=#cdd6f4,bg=#313244] #I #W #[fg=#313244,bg=#1e1e2e,nobold]'
setw -g window-status-current-format '#[fg=#1e1e2e,bg=#f38ba8,nobold]#[fg=#1e1e2e,bg=#f38ba8,bold] #I #W #[fg=#f38ba8,bg=#1e1e2e,nobold]'
setw -g window-status-separator ''

# Pane borders
set -g pane-border-style 'fg=#313244'
set -g pane-active-border-style 'fg=#89b4fa'

# Message style
set -g message-style 'fg=#cdd6f4,bg=#313244,bold'

# Clock
setw -g clock-mode-colour '#89b4fa'
setw -g clock-mode-style 24

# Plugins (using TPM - Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'
set -g @plugin 'tmux-plugins/tmux-net-speed'
set -g @plugin 'christoomey/vim-tmux-navigator'

# Plugin settings
# Resurrect
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'

# Continuum
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'

# Prefix highlight
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'
set -g @prefix_highlight_prefix_prompt 'PREFIX'
set -g @prefix_highlight_copy_prompt 'COPY'
set -g @prefix_highlight_sync_prompt 'SYNC'

# Battery
set -g @batt_icon_status_charged ''
set -g @batt_icon_status_charging ''
set -g @batt_icon_status_discharging ''
set -g @batt_icon_status_attached ''
set -g @batt_icon_status_unknown ''

# CPU
set -g @cpu_low_icon "▁"
set -g @cpu_medium_icon "▃"
set -g @cpu_high_icon "▆"

# Net speed
set -g @net_speed_interfaces "eth0 wlan0"
set -g @download_speed_format "%10s"
set -g @upload_speed_format "%10s"
set -g @net_speed_format "D:%10s U:%10s"

# Update status bar with plugin information
set -g status-right '#[fg=#313244,bg=#1e1e2e,nobold]#[fg=#cdd6f4,bg=#313244] #{cpu_icon} #{cpu_percentage} #[fg=#45475a,bg=#313244,nobold]#[fg=#cdd6f4,bg=#45475a] #{battery_icon} #{battery_percentage} #[fg=#585b70,bg=#45475a,nobold]#[fg=#cdd6f4,bg=#585b70] %Y-%m-%d %H:%M #[fg=#89b4fa,bg=#585b70,nobold]#[fg=#1e1e2e,bg=#89b4fa,bold] #H #{prefix_highlight}'

# Local overrides
if-shell "[ -f ~/.tmux.conf.local ]" 'source ~/.tmux.conf.local'

# Initialize TPM (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'